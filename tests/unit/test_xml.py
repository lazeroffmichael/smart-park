"""
Testing module for proper parsing of Google Earth XML files
"""
import pytest
import os

from simulations.xml import XMLParse, ParseGoogleEarthPathXML

TEST_XML_NAME = 'xml_test.xml'


@pytest.yield_fixture(scope="module")
def xml_object():
    path = get_absolute_path()
    yield XMLParse(path)


@pytest.yield_fixture(scope="module")
def earth():
    path = get_absolute_path()
    yield ParseGoogleEarthPathXML(path)


def get_absolute_path():
    """
    Trys to get the absolute path of the test xml file
    :return: Path string
    """
    try:
        # Check if the file is in the current directory
        file = os.path.abspath('xml_test.xml')
        f = open(file)
        return file
    # File is not in the current directory, go to the next directory
    except FileNotFoundError:
        return os.path.abspath('./unit/xml_test.xml')


class TestInit:

    def test_init_method(self, xml_object):
        """
        Tests the init method sets the tree member
        """
        assert xml_object.tree
        assert xml_object.root


class TestGetRoot:

    def test_get_root(self, xml_object):
        """
        Tests getting the root works
        """
        root = xml_object.get_root()
        assert root


class TestGoogleEarth:

    def test_get_coordinates(self, earth):
        """
        Tests getting the coordinates from google earth xml path
        """
        expected = "-115.1408690853584,36.1098938621996,0," \
                   "-115.140871713412,36.10993178433706,0," \
                   "-115.1408756872484,36.10996816144998,0," \
                   "-115.1408772700682,36.11001196517206,0," \
                   "-115.1408817039778,36.11005437786634,0," \
                   "-115.1409002844525,36.11008285993982,0," \
                   "-115.1409302200396,36.11011606193365,0," \
                   "-115.1409449765952,36.11016288846638,0," \
                   "-115.1409405788584,36.11020225078855,0," \
                   "-115.1409335169188,36.11025017796519,0," \
                   "-115.1409257545448,36.11029329559425,0," \
                   "-115.1409203836459,36.11035042703013,0," \
                   "-115.1409232834832,36.11041122940435,0," \
                   "-115.1409007758304,36.11044843039741,0," \
                   "-115.1408329424049,36.11043990507649,0," \
                   "-115.1407658782201,36.11044672184875,0," \
                   "-115.140666476137,36.11044843014666,0," \
                   "-115.1406344022707,36.11045356537455,0," \
                   "-115.1406356348961,36.1105057647169,0," \
                   "-115.1406370542719,36.11054144221981,0," \
                   "-115.1405746104374,36.11054685600282,0," \
                   "-115.1405171091979,36.11055409999528,0," \
                   "-115.1405165686108,36.11060938001294,0," \
                   "-115.1405226616961,36.11063386791691,0"

        assert earth.get_coordinates() == expected

    def test_slice_escape_characters(self, earth):
        """
        Tests slicing escape characters method
        """
        original = "\n\t\t\t\t-115.1408690853584,36.1098938621996,0 " \
                   "-115.140871713412,36.10993178433706,0 " \
                   "-115.1408756872484,36.10996816144998,0 " \
                   "-115.1408772700682,36.11001196517206,0 " \
                   "-115.1408817039778,36.11005437786634,0 " \
                   "-115.1409002844525,36.11008285993982,0 " \
                   "-115.1409302200396,36.11011606193365,0 " \
                   "-115.1409449765952,36.11016288846638,0 " \
                   "-115.1409405788584,36.11020225078855,0 " \
                   "-115.1409335169188,36.11025017796519,0 " \
                   "-115.1409257545448,36.11029329559425,0 " \
                   "-115.1409203836459,36.11035042703013,0 " \
                   "-115.1409232834832,36.11041122940435,0 " \
                   "-115.1409007758304,36.11044843039741,0 " \
                   "-115.1408329424049,36.11043990507649,0 " \
                   "-115.1407658782201,36.11044672184875,0 " \
                   "-115.140666476137,36.11044843014666,0 " \
                   "-115.1406344022707,36.11045356537455,0 " \
                   "-115.1406356348961,36.1105057647169,0 " \
                   "-115.1406370542719,36.11054144221981,0 " \
                   "-115.1405746104374,36.11054685600282,0 " \
                   "-115.1405171091979,36.11055409999528,0 " \
                   "-115.1405165686108,36.11060938001294,0 " \
                   "-115.1405226616961,36.11063386791691,0 "

        expected = "-115.1408690853584,36.1098938621996,0 " \
                   "-115.140871713412,36.10993178433706,0 " \
                   "-115.1408756872484,36.10996816144998,0 " \
                   "-115.1408772700682,36.11001196517206,0 " \
                   "-115.1408817039778,36.11005437786634,0 " \
                   "-115.1409002844525,36.11008285993982,0 " \
                   "-115.1409302200396,36.11011606193365,0 " \
                   "-115.1409449765952,36.11016288846638,0 " \
                   "-115.1409405788584,36.11020225078855,0 " \
                   "-115.1409335169188,36.11025017796519,0 " \
                   "-115.1409257545448,36.11029329559425,0 " \
                   "-115.1409203836459,36.11035042703013,0 " \
                   "-115.1409232834832,36.11041122940435,0 " \
                   "-115.1409007758304,36.11044843039741,0 " \
                   "-115.1408329424049,36.11043990507649,0 " \
                   "-115.1407658782201,36.11044672184875,0 " \
                   "-115.140666476137,36.11044843014666,0 " \
                   "-115.1406344022707,36.11045356537455,0 " \
                   "-115.1406356348961,36.1105057647169,0 " \
                   "-115.1406370542719,36.11054144221981,0 " \
                   "-115.1405746104374,36.11054685600282,0 " \
                   "-115.1405171091979,36.11055409999528,0 " \
                   "-115.1405165686108,36.11060938001294,0 " \
                   "-115.1405226616961,36.11063386791691,0 "

        assert earth._slice_escape_characters(original) == expected

    def test_remove_spaces(self, earth):
        """
        Tests removing spaces and adding commas to the coordinate string
        """
        original = "-115.1408690853584,36.1098938621996,0 " \
                   "-115.140871713412,36.10993178433706,0 " \
                   "-115.1408756872484,36.10996816144998,0 " \
                   "-115.1408772700682,36.11001196517206,0 " \
                   "-115.1408817039778,36.11005437786634,0 " \
                   "-115.1409002844525,36.11008285993982,0 " \
                   "-115.1409302200396,36.11011606193365,0 " \
                   "-115.1409449765952,36.11016288846638,0 " \
                   "-115.1409405788584,36.11020225078855,0 " \
                   "-115.1409335169188,36.11025017796519,0 " \
                   "-115.1409257545448,36.11029329559425,0 " \
                   "-115.1409203836459,36.11035042703013,0 " \
                   "-115.1409232834832,36.11041122940435,0 " \
                   "-115.1409007758304,36.11044843039741,0 " \
                   "-115.1408329424049,36.11043990507649,0 " \
                   "-115.1407658782201,36.11044672184875,0 " \
                   "-115.140666476137,36.11044843014666,0 " \
                   "-115.1406344022707,36.11045356537455,0 " \
                   "-115.1406356348961,36.1105057647169,0 " \
                   "-115.1406370542719,36.11054144221981,0 " \
                   "-115.1405746104374,36.11054685600282,0 " \
                   "-115.1405171091979,36.11055409999528,0 " \
                   "-115.1405165686108,36.11060938001294,0 " \
                   "-115.1405226616961,36.11063386791691,0 "

        expected = "-115.1408690853584,36.1098938621996,0," \
                   "-115.140871713412,36.10993178433706,0," \
                   "-115.1408756872484,36.10996816144998,0," \
                   "-115.1408772700682,36.11001196517206,0," \
                   "-115.1408817039778,36.11005437786634,0," \
                   "-115.1409002844525,36.11008285993982,0," \
                   "-115.1409302200396,36.11011606193365,0," \
                   "-115.1409449765952,36.11016288846638,0," \
                   "-115.1409405788584,36.11020225078855,0," \
                   "-115.1409335169188,36.11025017796519,0," \
                   "-115.1409257545448,36.11029329559425,0," \
                   "-115.1409203836459,36.11035042703013,0," \
                   "-115.1409232834832,36.11041122940435,0," \
                   "-115.1409007758304,36.11044843039741,0," \
                   "-115.1408329424049,36.11043990507649,0," \
                   "-115.1407658782201,36.11044672184875,0," \
                   "-115.140666476137,36.11044843014666,0," \
                   "-115.1406344022707,36.11045356537455,0," \
                   "-115.1406356348961,36.1105057647169,0," \
                   "-115.1406370542719,36.11054144221981,0," \
                   "-115.1405746104374,36.11054685600282,0," \
                   "-115.1405171091979,36.11055409999528,0," \
                   "-115.1405165686108,36.11060938001294,0," \
                   "-115.1405226616961,36.11063386791691,0"

        assert earth._remove_spaces_add_commas(original) == expected

